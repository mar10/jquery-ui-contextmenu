(function(e){function n(e){return e&&e.match(/^#/)?e.substring(1):e||""}var t="onselectstart"in document.createElement("div");e.widget("ui.contextmenu",{version:"0.4.1",options:{delegate:"[data-menu]",hide:{effect:"fadeOut",duration:"fast"},show:{effect:"slideDown",duration:"slow"},position:null,ignoreParentSelect:true,menu:null,preventSelect:false,taphold:false,beforeOpen:e.noop,blur:e.noop,close:e.noop,create:e.noop,focus:e.noop,init:e.noop,open:e.noop,select:e.noop},_create:function(){var n,r,i=this.options;this.$headStyle=null;this.orgMenu=null;this.currentTarget=null;this.ns="."+this.widgetName;if(i.preventSelect){r=(e(this.element).is(document)?e("body"):this.element).uniqueId().attr("id");this.$headStyle=e("<style class='ui-contextmenu-style'>").prop("type","text/css").html("#"+r+" "+i.delegate+" { "+"-webkit-user-select: none; "+"-khtml-user-select: none; "+"-moz-user-select: none; "+"-ms-user-select: none; "+"user-select: none; "+"}").appendTo("head");if(t){this.element.delegate(i.delegate,"selectstart"+this.ns,function(e){e.preventDefault()})}}if(e.isArray(i.menu)){this.orgMenu=i.menu;i.menu=e.ui.contextmenu.createMenuMarkup(i.menu)}this._getMenu().hide().addClass("ui-contextmenu").menu({blur:e.proxy(this.options.blur,this),create:e.proxy(this.options.create,this),focus:e.proxy(this.options.focus,this),select:e.proxy(function(e,t){e.relatedTarget=this.currentTarget;var n=t.item.has(">a[aria-haspopup='true']").length>0;if(!n||!this.options.ignoreParentSelect){if(this._trigger.call(this,"select",e,t)!==false){this._closeMenu.call(this)}e.preventDefault()}},this)});n="contextmenu"+this.ns;if(i.taphold){n+=" taphold"+this.ns}this.element.delegate(i.delegate,n,e.proxy(this._openMenu,this));this._trigger("init")},_destroy:function(e,t){if(this.$headStyle){this.$headStyle.remove();this.$headStyle=null}if(this.orgMenu){this.options.menu.remove();this.options.menu=this.orgMenu;this.orgMenu=null}},_openMenu:function(t){var n=this,r=this._getMenu(),i=t,s=i.target?i.target:i,o={menu:r};this.currentTarget=i.target;t.preventDefault();t.relatedTarget=this.currentTarget;if(this._trigger("beforeOpen",t,o)===false){return false}e(document).bind("keydown"+this.ns,function(t){if(t.which===e.ui.keyCode.ESCAPE){n._closeMenu()}}).bind("mousedown"+this.ns+" touchstart"+this.ns,function(t){if(!e(t.target).closest(".ui-menu-item").length){n._closeMenu()}});var u=this.options.position;if(u==null){u={my:"left top",at:"left bottom",of:s,collision:"fit"}}else if(jQuery.isFunction(this.options.position)){u=u(t,o)}else{var a=u.of;if(a==null){u.of=s}}r.show().css({position:"absolute",left:0,top:0}).position(u).hide();this._show(r,this.options.show,function(){n._trigger.call(n,"open",t)})},_closeMenu:function(){var t=this,n=this._getMenu();this._hide(n,this.options.hide,function(){t._trigger("close");this.currentTarget=null});e(document).unbind("mousedown"+this.ns).unbind("touchstart"+this.ns).unbind("keydown"+this.ns)},_setOption:function(t,n){switch(t){case"menu":this.replaceMenu(n);break}e.Widget.prototype._setOption.apply(this,arguments)},_getMenu:function(){var t=this.options.menu;return typeof t==="string"?e(t):t},open:function(e){var t=jQuery.Event("contextmenu",{target:e.get(0)});return this.element.trigger(t)},close:function(){return this._closeMenu.call(this)},enableEntry:function(e,t){var r=this.element.find("a[href=#"+n(e)+"]");r.toggleClass("ui-state-disabled",t===false)},replaceMenu:function(t){var n=this.options,r=this._getMenu();if(e.isArray(t)){if(this.orgMenu){r.empty();e.ui.contextmenu.createMenuMarkup(t,n.menu);r.menu("refresh")}else{e.error("not implemented")}}else{e.error("not implemented")}},setEntry:function(t,r){var i,s=this.element.find("a[href=#"+n(t)+"]");if(typeof r==="string"){s.contents().filter(function(){return this.nodeType===3}).first().replaceWith(r)}else{i=s.closest("li").empty();e.ui.contextmenu.createEntryMarkup(r,i)}},showEntry:function(e,t){var r=this.element.find("a[href=#"+n(e)+"]");r.toggle(t!==false)}});e.extend(e.ui.contextmenu,{createEntryMarkup:function(t,r){var i=null;if(t.title.match(/^---/)){r.text(t.title)}else{i=e("<a>",{text:""+t.title,href:"#"+n(t.cmd)}).appendTo(r);if(t.uiIcon){i.append(e("<span class='ui-icon'>").addClass(t.uiIcon))}if(t.disabled){r.addClass("ui-state-disabled")}}return i},createMenuMarkup:function(t,n){var r,i,s,o;if(n==null){n=e("<ul class='ui-helper-hidden'>").appendTo("body")}for(r=0;r<t.length;r++){i=t[r];o=e("<li>").appendTo(n);e.ui.contextmenu.createEntryMarkup(i,o);if(e.isArray(i.children)){s=e("<ul>").appendTo(o);e.ui.contextmenu.createMenuMarkup(i.children,s)}}return n}})})(jQuery)
